package com.flightapp.bookingservice.service.impl;

import java.time.LocalDateTime;
import java.util.List;
import java.util.UUID;
import java.util.stream.Collectors;

import javax.persistence.Column;

import org.springframework.stereotype.Service;

import com.flightapp.bookingservice.dto.BookingRequestDto;
import com.flightapp.bookingservice.dto.PassengerDetailsDto;
import com.flightapp.bookingservice.model.Booking;
import com.flightapp.bookingservice.model.PassengerDetails;
import com.flightapp.bookingservice.repository.BookingRepository;
import com.flightapp.bookingservice.service.BookingService;

import lombok.RequiredArgsConstructor;

@Service
@RequiredArgsConstructor
public class BookingServiceImpl implements BookingService{
	
	private final BookingRepository bookingRepository;

	@Override
	public void bookTicket(BookingRequestDto bookingRequest) {
		Booking bookingDetails = new Booking();
		bookingDetails.setPnrNumber(UUID.randomUUID().toString());
		
		//to convert Dto to model
		List<PassengerDetails> passengerDetailsList = bookingRequest.getPassengerDetailsDtoList().stream()
				.map(this::mapToDto).collect(Collectors.toList());
		
		bookingDetails.setPassengerDetails(passengerDetailsList);
		
		bookingRepository.save(bookingDetails);
	}
	
	private PassengerDetails mapToModelPassengerDetails(PassengerDetailsDto passengerDetailsDto) {
		return PassengerDetails.builder().passengerName(passengerDetailsDto.getPassengerName())
				.gender(passengerDetailsDto.getGender()).age(passengerDetailsDto.getAge())
				.idProofNumber(passengerDetailsDto.getGender()).build();
	}
	
	private Booking mapToModel(BookingRequestDto bookingRequestDto) {
		return Booking.builder().email(bookingRequestDto.getEmail()).flightId(bookingRequestDto.getFlightId()).build();
	}

}
